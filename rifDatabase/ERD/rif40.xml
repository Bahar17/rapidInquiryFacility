<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE db-schema SYSTEM "file:///db-schema.dtd">

<!--
    Imported schema:
        Driver class: org.postgresql.Driver
        JDBC URL: jdbc:postgresql://:5432/sahsuland?user=rif40&amp;password=Se11afield2014
        DBMS type: postgres8
-->

<db-schema name="sahsuland" schema="rif40">
    <templates>
        <!-- TODO -->
    </templates>

    <!--
    ======================================================================
        Sequences
    ======================================================================
    -->

    <sequence dbms="postgres8" name="rif40_inv_id_seq" >
    </sequence>

    <sequence dbms="postgres8" name="rif40_study_id_seq" >
    </sequence>

    <!--
    ======================================================================
        Tables
    ======================================================================
    -->

    <table name="rif40_age_group_names" description="RIF Age group names"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="age_group_id" description="AGE_GROUP_ID" type="short" allows-null="false" />
            <column name="age_group_name" description="Age Group Name" type="varchar" length="50" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_age_group_names_pk">
                <column-ref name="age_group_id" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select, references" />
        </grants>
    </table>

    <table name="rif40_dual" description="RIF40 version of dual table (for remote execution on Postgres)"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="dummy" description="Dummy column" type="varchar" length="1" allows-null="true" />
        </columns>
        <constraints>
        </constraints>
        <grants>
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_error_messages" description="RIF error messages resulting from schema violations"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="error_code" description="Error code" type="int" allows-null="false" />
            <column name="tag" description="Contextual tag for error code" type="varchar" length="80" allows-null="false" />
            <column name="table_name" description="Table raising error. If NULL, procedure or other code." type="varchar" length="30" allows-null="true" />
            <column name="cause" description="Cause of error" type="varchar" length="4000" allows-null="false" />
            <column name="action" description="Action to resolve error" type="varchar" length="512" allows-null="false" />
            <column name="message" description="Error message" type="varchar" length="512" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_error_messages_pk">
                <column-ref name="error_code" />
                <column-ref name="tag" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_geographies" description="Pre-defined hierarchial geographies. Usually based on Census geography. Beware of the foreign key from RIF40_GEOGRAPHIES.DEFAULTCOMPAREA to RIF40_GEOLEVELS. When inserting a new geography do NOT set DEFAULTCOMPAREA, update it after adding geolevels to T_RIF40_GEOLEVELS"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="geography" description="Geography name" type="varchar" length="50" allows-null="false" />
            <column name="description" description="Description" type="varchar" length="250" allows-null="false" />
            <column name="hierarchytable" description="Hierarchy table" type="varchar" length="30" allows-null="false" />
            <column name="srid" description="Postgres projection SRID" type="int" allows-null="true" default-value="0" />
            <column name="defaultcomparea" description="Default comparison area" type="varchar" length="30" allows-null="true" />
            <column name="defaultstudyarea" description="Default study area" type="varchar" length="30" allows-null="true" />
            <column name="postal_population_table" description="Postal population table. Table of postal points (e.g. postcodes, ZIP codes); geolevels; X and YCOORDINATES (in projection SRID); male, female and total populations. Converted to SRID points by loader [not in 4326 Web Mercator lat/long]. Used in creating population wieght centroids and in converting postal points to geolevels. Expected columns &amp;lt;postal_point_column&amp;gt;, XCOORDINATE, YCOORDINATE, 1+ &amp;lt;GEOLEVEL_NAME&amp;gt;, MALES, FEMALES, TOTAL" type="varchar" length="30" allows-null="true" />
            <column name="postal_point_column" description="Column name for postal points (e.g. POSTCODE, ZIP_CODE)" type="varchar" length="30" allows-null="true" />
            <column name="partition" description="Enable partitioning. Extract tables will be partition if the number of years >= 2x the RIF40_PARAMETERS parameters Parallelisation [which has a default of 4, so extracts covering 8 years or more will be partitioned]. " type="short" allows-null="true" default-value="0" />
            <column name="max_geojson_digits" description="Max digits in ST_AsGeoJson() [optimises file size by removing unecessary precision, the default value of 8 is normally fine.]" type="short" allows-null="true" default-value="8" />
        </columns>
        <constraints>
            <primary-key name="rif40_geographies_pk">
                <column-ref name="geography" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select, references" />
        </grants>
    </table>

    <table name="rif40_health_study_themes" description="RIF health study themes"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="theme" description="Theme" type="varchar" length="30" allows-null="false" />
            <column name="description" description="Description" type="varchar" length="200" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_health_study_themes_pk">
                <column-ref name="theme" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select, references" />
        </grants>
    </table>

    <table name="rif40_icd10" description="ICD10 code (SAHSU historic version, needs to be updated)"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="icd10_1char" description="ICD10 chapter" type="varchar" length="20" allows-null="true" />
            <column name="icd10_3char" description="3 Character ICD10 code" type="varchar" length="3" allows-null="true" />
            <column name="icd10_4char" description="4 Character ICD10 code" type="varchar" length="4" allows-null="false" />
            <column name="text_1char" description="ICD10 chapter textual description" type="varchar" length="250" allows-null="true" />
            <column name="text_3char" description="3 Character ICD10 textual description" type="varchar" length="250" allows-null="true" />
            <column name="text_4char" description="4 Character ICD10 textual description" type="varchar" length="250" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_icd10_pk">
                <column-ref name="icd10_4char" />
            </primary-key>
        </constraints>
        <indexes>
            <index name="rif40_icd10_1char_bm" unique="false">
                <column-ref name="icd10_1char" />
            </index>
            <index name="rif40_icd10_3char_bm" unique="false">
                <column-ref name="icd10_3char" />
            </index>
        </indexes>
        <grants>
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_icd9" description="ICD9 code (SAHSU historic version, needs to be updated)"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="icd9_3char" description="3 Character ICD9 code" type="varchar" length="3" allows-null="true" />
            <column name="icd9_4char" description="4 Character ICD9 code" type="varchar" length="4" allows-null="false" />
            <column name="text_3char" description="3 Character ICD9 textual description" type="varchar" length="250" allows-null="true" />
            <column name="text_4char" description="4 Character ICD9 textual description" type="varchar" length="250" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_icd9_pk">
                <column-ref name="icd9_4char" />
            </primary-key>
        </constraints>
        <indexes>
            <index name="rif40_icd9_3char_bm" unique="false">
                <column-ref name="icd9_3char" />
            </index>
        </indexes>
        <grants>
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_outcomes" description="Health Outcomes. This table give the locations of the various Health Outcomes lookup tables, e.g RIF40_ICD10. Outcomes typically supported are ICD 9, 10, OPCS4 operation codes, ICD-0 Histology"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="outcome_type" description="Outcome type: ICD, ICD-0 or OPCS" type="varchar" length="20" allows-null="false" />
            <column name="outcome_description" description="Outcome Description" type="varchar" length="250" allows-null="false" />
            <column name="current_version" description="Current Version, e.g 10 for ICD" type="varchar" length="20" allows-null="false" />
            <column name="current_sub_version" description="Current Sub Version, e.g. 11th Revision - 2010" type="varchar" length="20" allows-null="true" />
            <column name="previous_version" description="Previous version, e.g. 9" type="varchar" length="20" allows-null="true" />
            <column name="previous_sub_version" description="Previous sub version" type="varchar" length="20" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_outcomes_pk">
                <column-ref name="outcome_type" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_reference_tables" description="List of references tables without constraints"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="table_name" description="Table name" type="varchar" length="30" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_reference_tables_pk">
                <column-ref name="table_name" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_tables_and_views" description="RIF40 Tables and Views"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="class" description="Class" type="varchar" length="13" allows-null="true" />
            <column name="table_or_view" description="Table name" type="varchar" length="178" allows-null="true" />
            <column name="table_or_view_name_hide" description="Table name (web version)" type="varchar" length="40" allows-null="false" />
            <column name="comments" description="Comments" type="varchar" length="4000" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="table_or_view_name_hide_pk">
                <column-ref name="table_or_view_name_hide" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select" />
            <grant role="rif_user" actions="select" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="rif40_version" description="RIF version"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="version" description="Version. Used for change control to ensure front end matches database." type="varchar" length="50" allows-null="false" />
            <column name="schema_created" description="Date schema created" type="datetime" allows-null="true" default-value="('now'::text)::timestamp without time zone" />
            <column name="schema_amended" description="Date schema amended" type="datetime" allows-null="true" />
            <column name="cvs_revision" description="CVS revison control information for last amendment" type="varchar" length="50" allows-null="false" />
        </columns>
        <constraints>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="t_rif40_num_denom" description="Private copy of extra numerator and denominator pairs not added automatically."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="geography" description="Geography (e.g EW2001)" type="varchar" length="50" allows-null="false" />
            <column name="numerator_table" description="Numerator table" type="varchar" length="30" allows-null="false" />
            <column name="denominator_table" description="Denominator table" type="varchar" length="30" allows-null="false" />
            <column name="geography" description="Geography (e.g EW2001)" type="varchar" length="50" allows-null="false" />
            <column name="numerator_table" description="Numerator table" type="varchar" length="30" allows-null="false" />
            <column name="denominator_table" description="Denominator table" type="varchar" length="30" allows-null="false" />
        </columns>
        <constraints>
        </constraints>
        <indexes>
            <index name="rif40_num_denom_pk" unique="true">
                <column-ref name="geography" />
                <column-ref name="numerator_table" />
                <column-ref name="denominator_table" />
            </index>
        </indexes>
        <grants>
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_parameters" description="RIF40 parameters. Use this table for INSERT/UPDATE/DELETE; use RIF40_PARAMETERS for SELECT. User needs RIF_NO_SUPPRESSION granted as a role to see unsuppressed results"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="param_name" description="Parameter" type="varchar" length="30" allows-null="false" />
            <column name="param_value" description="Value" type="varchar" length="50" allows-null="false" />
            <column name="param_description" description="Description" type="varchar" length="250" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_parameters_pk">
                <column-ref name="param_name" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="t_rif40_projects" description="RIF projects"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="project" description="Project name" type="varchar" length="30" allows-null="false" />
            <column name="description" description="Project description" type="varchar" length="250" allows-null="false" />
            <column name="date_started" description="Date project started" type="datetime" allows-null="true" default-value="('now'::text)::timestamp without time zone" />
            <column name="date_ended" description="Date project ended" type="datetime" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_projects_pk">
                <column-ref name="project" />
            </primary-key>
        </constraints>
        <grants>
            <grant role="rif_user" actions="select" />
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="rif40_age_groups" description="RIF age groups"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="age_group_id" description="AGE_GROUP_ID" type="short" allows-null="false" />
            <column name="offset" description="Offset" type="short" allows-null="false" />
            <column name="low_age" description="Low age" type="short" allows-null="false" />
            <column name="high_age" description="High age" type="short" allows-null="false" />
            <column name="fieldname" description="Fieldname" type="varchar" length="50" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_age_groups_pk">
                <column-ref name="age_group_id" />
                <column-ref name="offset" />
            </primary-key>
            <foreign-key name="rif40_age_group_id_fk" references="rif40_age_group_names">
                <column-ref name="age_group_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="rif40_age_groups_pk2" unique="true">
                <column-ref name="age_group_id" />
                <column-ref name="fieldname" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select, references" />
        </grants>
    </table>

    <table name="rif40_columns" description="RIF40 Columns"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="table_or_view_name_hide" description="Table name" type="varchar" length="40" allows-null="false" />
            <column name="column_name_hide" description="Column name" type="varchar" length="40" allows-null="false" />
            <column name="nullable" description="Nollable" type="varchar" length="8" allows-null="true" />
            <column name="oracle_data_type" description="Oracle data type" type="varchar" length="189" allows-null="true" />
            <column name="comments" description="Comments" type="varchar" length="4000" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_columns_pk">
                <column-ref name="table_or_view_name_hide" />
                <column-ref name="column_name_hide" />
            </primary-key>
            <foreign-key name="table_or_view_name_hide_fk" references="rif40_tables_and_views">
                <column-ref name="table_or_view_name_hide" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select" />
            <grant role="rif_user" actions="select" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="rif40_outcome_groups" description="Collection of Health outcomes into logical groups. E.g. Single variable ICD9 and 10"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="outcome_type" description="Outcome type: ICD, ICD-0 or OPCS" type="varchar" length="20" allows-null="false" />
            <column name="outcome_group_name" description="Outcome Group Name. E.g SINGLE_VARIABLE_ICD" type="varchar" length="30" allows-null="false" />
            <column name="outcome_group_description" description="Outcome Group Description. E.g. &amp;quot;Single variable ICD&amp;quot;" type="varchar" length="250" allows-null="false" />
            <column name="field_name" description="Outcome field name, e.g. ICD_SAHSU_01, ICD_SAHSU" type="varchar" length="30" allows-null="false" />
            <column name="multiple_field_count" description="Outcome Group multiple field count (0-99). E.g if NULL then field is ICD_SAHSU_01; if 20 then fields are ICD_SAHSU_01 to ICD_SAHSU_20. Field numbers are assumed to tbe left padded to 2 characters with &amp;quot;0&amp;quot; and preceeded by an &amp;quot;_&amp;quot;" type="short" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_outcome_groups_pk">
                <column-ref name="outcome_group_name" />
            </primary-key>
            <foreign-key name="rif40_outcome_groups_type_fk" references="rif40_outcomes">
                <column-ref name="outcome_type" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_predefined_groups" description="Predefined Health Outcomes"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="predefined_group_name" description="Predefined Group Name. E.g LUNG_CANCER" type="varchar" length="30" allows-null="false" />
            <column name="predefined_group_description" description="Predefined Group Description. E.g. &amp;quot;Lung Cancer&amp;quot;" type="varchar" length="250" allows-null="false" />
            <column name="outcome_type" description="Outcome type: ICD, ICD-0 or OPCS" type="varchar" length="20" allows-null="false" />
            <column name="condition" description="SQL WHERE clause, with the WHERE keyword omitted). Default to 1=1 (use all records matching year/age/sex criteria). Checked for SQL injection." type="varchar" length="4000" allows-null="true" default-value="'1=1'::character varying" />
        </columns>
        <constraints>
            <primary-key name="rif40_predefined_groups_pk">
                <column-ref name="predefined_group_name" />
            </primary-key>
            <foreign-key name="rif40_predefined_type_fk" references="rif40_outcomes">
                <column-ref name="outcome_type" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="rif40_tables" description="RIF numerator and denominator tables"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="theme" description="Health Study theme" type="varchar" length="30" allows-null="false" />
            <column name="table_name" description="RIF table name. Normally the schema owner will not be able to see the health data tables, so no error is raised if the table cannot be resolved to an acceisble object. The schema owner must have access to automatic indirect standardisation denominators." type="varchar" length="30" allows-null="false" />
            <column name="description" description="Description" type="varchar" length="250" allows-null="false" />
            <column name="year_start" description="Year table starts" type="short" allows-null="false" />
            <column name="year_stop" description="Year table stops" type="short" allows-null="false" />
            <column name="total_field" description="Total field (when used aggregated tables)" type="varchar" length="30" allows-null="true" />
            <column name="isindirectdenominator" description="Is table a denominator to be used in indirect standardisation (0/1)" type="short" allows-null="false" />
            <column name="isdirectdenominator" description="Is table a denominator to be used in direct standardisation (0/1). E.g. POP_WORLD, POP_EUROPE." type="short" allows-null="false" />
            <column name="isnumerator" description="Is table a numerator  (0/1)" type="short" allows-null="false" />
            <column name="automatic" description="Able to be used in automatic RIF40_NUM_DENOM (0/1, default 0). Cannot be applied to direct standardisation denominator. Restricted to 1 denominator per geography to prevent the automatic RIF40_NUM_DENOM having &amp;gt;1 pair per numerator. This restriction is actually enforced in RIF40_NUM_DENOM because of the &amp;quot;ORA-04091: table RIF40.RIF40_TABLES is mutating, trigger/function may not see it&amp;quot; error. A user specific T_RIF40_NUM_DENOM is supplied for other combinations. The default is 0 because of the restrictions." type="short" allows-null="true" default-value="0" />
            <column name="sex_field_name" description="Name of SEX field. No default. AGE_GROUP_FIELD_NAME must be set, AGE_SEX_GROUP_FIELD_NAME must not be set." type="varchar" length="30" allows-null="true" />
            <column name="age_group_field_name" description="Name of AGE_GROUP field. No default. SEX_FIELD_NAME must be set, AGE_SEX_GROUP_FIELD_NAME must not be set." type="varchar" length="30" allows-null="true" />
            <column name="age_sex_group_field_name" description="Name of AGE_SEX_GROUP field. Default: AGE_SEX_GROUP; AGE_GROUP_FIELD_NAME and SEX_FIELD_NAME must not be set." type="varchar" length="30" allows-null="true" default-value="'AGE_SEX_GROUP'::character varying" />
            <column name="age_group_id" description="Type of RIF age group in use. Link to RIF40_AGE_GROUP_NAMES. No default." type="short" allows-null="true" />
            <column name="validation_date" description="Date table contents were validated OK." type="datetime" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_tables_pk">
                <column-ref name="table_name" />
            </primary-key>
            <foreign-key name="rif40_tables_age_group_id_fk" references="rif40_age_group_names">
                <column-ref name="age_group_id" />
            </foreign-key>
            <foreign-key name="rif40_tables_theme_fk" references="rif40_health_study_themes">
                <column-ref name="theme" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select, references" />
        </grants>
    </table>

    <table name="rif40_triggers" description="RIF40 Triggers"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="table_name" description="Table name" type="varchar" length="30" allows-null="false" />
            <column name="column_name" description="Column name" type="varchar" length="4000" allows-null="true" />
            <column name="trigger_name" description="Trigger name" type="varchar" length="30" allows-null="false" />
            <column name="trigger_type" description="Type type" type="varchar" length="16" allows-null="true" />
            <column name="triggering_event" description="Triggering event" type="varchar" length="227" allows-null="true" />
            <column name="when_clause" description="When clause" type="varchar" length="4000" allows-null="true" />
            <column name="action_type" description="Action type" type="varchar" length="11" allows-null="true" />
            <column name="comments" description="Comments" type="varchar" length="4000" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_triggers_pk">
                <column-ref name="table_name" />
                <column-ref name="trigger_name" />
            </primary-key>
            <foreign-key name="table_or_view_name_hide_fk" references="rif40_tables_and_views">
                <column-ref name="table_name" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select" />
            <grant role="rif_user" actions="select" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_geolevels" description="Geolevels: hierarchy of level with a geography. Use this table for INSERT/UPDATE/DELETE; use RIF40_GEOLEVELS for SELECT. In RIF40_GEOLEVELS if the user has the RIF_STUDENT role the geolevels are restricted to LADUA/DISTRICT level resolution or lower."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="geography" description="Geography (e.g EW2001)" type="varchar" length="50" allows-null="false" />
            <column name="geolevel_name" description="Name of geolevel. This will be a column name in the numerator/denominator tables" type="varchar" length="30" allows-null="false" />
            <column name="geolevel_id" description="ID for ordering (1=lowest resolution). Up to 99 supported." type="short" allows-null="false" />
            <column name="description" description="Description" type="varchar" length="250" allows-null="false" />
            <column name="lookup_table" description="Lookup table name. This is used to translate codes to the common names, e.g a LADUA of 00BK is &amp;quot;Westminster&amp;quot;" type="varchar" length="30" allows-null="false" />
            <column name="lookup_desc_column" description="Lookup table description column name." type="varchar" length="30" allows-null="false" />
            <column name="centroidxcoordinate_column" description="Lookup table centroid X co-ordinate column name. Can also use CENTROIDSFILE instead." type="varchar" length="30" allows-null="true" />
            <column name="centroidycoordinate_column" description="Lookup table centroid Y co-ordinate column name." type="varchar" length="30" allows-null="true" />
            <column name="shapefile" description="Location of the GIS shape file. NULL if PostGress/PostGIS used. Can also use SHAPEFILE_GEOMETRY instead," type="varchar" length="512" allows-null="true" />
            <column name="centroidsfile" description="Location of the GIS centroids file. Can also use CENTROIDXCOORDINATE_COLUMN, CENTROIDYCOORDINATE_COLUMN instead." type="varchar" length="512" allows-null="true" />
            <column name="shapefile_table" description="Table containing GIS shape file data (created using shp2pgsql)." type="varchar" length="30" allows-null="true" />
            <column name="shapefile_area_id_column" description="Column containing the AREA_IDs in SHAPEFILE_TABLE" type="varchar" length="30" allows-null="true" />
            <column name="shapefile_desc_column" description="Column containing the AREA_ID descriptions in SHAPEFILE_TABLE" type="varchar" length="30" allows-null="true" />
            <column name="centroids_table" description="Table containing GIS shape file data with Arc GIS calculated population weighted centroids (created using shp2pgsql). PostGIS does not support population weighted centroids." type="varchar" length="30" allows-null="true" />
            <column name="centroids_area_id_column" description="Column containing the AREA_IDs in CENTROIDS_TABLE. X and Y co-ordinates ciolumns are asummed to be named after CENTROIDXCOORDINATE_COLUMN and CENTROIDYCOORDINATE_COLUMN." type="varchar" length="30" allows-null="true" />
            <column name="avg_npoints_geom" description="Average number of points in a geometry object (AREA_ID). Used to evaluation the impact of ST_SIMPLIFY_TOLERANCE." type="long" allows-null="true" />
            <column name="avg_npoints_opt" description="Average number of points in a ST_SimplifyPreserveTopology() optimsed geometry object (AREA_ID). Used to evaluation the impact of ST_SIMPLIFY_TOLERANCE." type="long" allows-null="true" />
            <column name="file_geojson_len" description="File length estimate (in bytes) for conversion of the entire geolevel geometry to GeoJSON. Used to evaluation the impact of ST_SIMPLIFY_TOLERANCE." type="long" allows-null="true" />
            <column name="leg_geom" description="The average length (in projection units - usually metres) of a vector leg. Used to evaluation the impact of ST_SIMPLIFY_TOLERANCE." length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="leg_opt" description="The average length (in projection units - usually metres) of a ST_SimplifyPreserveTopology() optimsed geometryvector leg. Used to evaluation the impact of ST_SIMPLIFY_TOLERANCE." length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="covariate_table" description="Name of table used for covariates at this geolevel" type="varchar" length="30" allows-null="true" />
            <column name="restricted" description="Is geolevel access rectricted by Inforamtion Governance restrictions (0/1). If 1 (Yes) then a) students cannot access this geolevel and b) if the system parameter ExtractControl=1 then the user must be granted permission by a RIF_MANAGER to extract from the database the results, data extract and maps tables. This is enforced by the RIF application." type="short" allows-null="true" default-value="0" />
            <column name="resolution" description="Can use a map for selection at this resolution (0/1)" type="short" allows-null="false" />
            <column name="comparea" description="Able to be used as a comparison area (0/1)" type="short" allows-null="false" />
            <column name="listing" description="Able to be used in a disease map listing (0/1)" type="short" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_geolevels_pk">
                <column-ref name="geography" />
                <column-ref name="geolevel_name" />
            </primary-key>
            <foreign-key name="t_rif40_geolevels_geog_fk" references="rif40_geographies">
                <column-ref name="geography" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_geolevels_uk2" unique="true">
                <column-ref name="geography" />
                <column-ref name="geolevel_id" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="t_rif40_user_projects" description="RIF project users"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="project" description="Project name" type="varchar" length="30" allows-null="false" />
            <column name="username" description="Username" type="varchar" length="90" allows-null="false" default-value="current_user()" />
            <column name="grant_date" description="Date project access granted" type="datetime" allows-null="true" default-value="('now'::text)::timestamp without time zone" />
            <column name="revoke_date" description="Date project access revoke_date" type="datetime" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_user_projects_pk">
                <column-ref name="project" />
                <column-ref name="username" />
            </primary-key>
            <foreign-key name="rif40_user_projects_project_fk" references="t_rif40_projects">
                <column-ref name="project" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_user" actions="select" />
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="rif40_covariates" description="RIF multiple covariates"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="geography" description="Geography (e.g EW2001)" type="varchar" length="50" allows-null="false" />
            <column name="geolevel_name" description="Name of geolevel. This will be a column name in the numerator/denominator tables" type="varchar" length="30" allows-null="false" />
            <column name="covariate_name" description="Covariate name. This will be a column name in RIF40_GEOLEVELS.COVARIATE_TABLE" type="varchar" length="30" allows-null="false" />
            <column name="min" description="Minimum value" length="17" scale="17" allows-null="false" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="max" description="Maximum value" length="17" scale="17" allows-null="false" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="type" description="TYPE of covariate (1=integer score/2=continuous variable). Min &amp;lt; max  max/min precison is appropriate to type. Continuous variables are not currently supported. Integer scores can be a binary variable 0/1 or an NTILE e.g. 1..5 for a quintile." length="17" scale="17" allows-null="false" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
        </columns>
        <constraints>
            <primary-key name="rif40_covariates_pk">
                <column-ref name="geography" />
                <column-ref name="geolevel_name" />
                <column-ref name="covariate_name" />
            </primary-key>
            <foreign-key name="rif40_covariates_geog_fk" references="rif40_geographies">
                <column-ref name="geography" />
            </foreign-key>
            <foreign-key name="rif40_covariates_geolevel_fk" references="t_rif40_geolevels">
                <column-ref name="geography" />
                <column-ref name="geolevel_name" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_user" actions="select" />
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="rif40_table_outcomes" description="Intersection of health outcomes in logical groups and Health tables. Mutliple groups supported per table"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="outcome_group_name" description="Outcome Group Name. E.g SINGLE_VARIABLE_ICD" type="varchar" length="20" allows-null="false" />
            <column name="numer_tab" description="Numerator table name." type="varchar" length="30" allows-null="false" />
            <column name="current_version_start_year" description="Year of change from current version to previous version" type="short" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="rif40_table_outcomes_pk">
                <column-ref name="outcome_group_name" />
                <column-ref name="numer_tab" />
            </primary-key>
            <foreign-key name="rif40_outcome_group_name_fk" references="rif40_outcome_groups">
                <column-ref name="outcome_group_name" />
            </foreign-key>
            <foreign-key name="rif40_outcome_numer_tab_fk" references="rif40_tables">
                <column-ref name="numer_tab" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select" />
        </grants>
    </table>

    <table name="t_rif40_fdw_tables" description="RIF numerator tables which are Foreign data wrappers in Postgres"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="User name" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="table_name" description="RIF table name. Normally the schema owner will not be able to see the health data tables, so no error is raised if the table cannot be resolved to an acceisble object. The schema owner must have access to automatic indirect standardisation denominators." type="varchar" length="30" allows-null="false" />
            <column name="create_status" description="Create status: C (Created, no errors), E(Created, errors in test SELECT), N(Not created, errors)" type="varchar" length="1" allows-null="false" />
            <column name="error_message" description="Error message when create status is: E(Created, errors in test SELECT, N(Not created, errors)" type="varchar" length="300" allows-null="true" />
            <column name="date_created" description="Date FDW table created (or attempted to be)" type="datetime" allows-null="true" default-value="('now'::text)::timestamp without time zone" />
            <column name="rowtest_passed" description="SELECT rowtest passed (0/1)" type="short" allows-null="true" default-value="0" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_fdw_tables_pk">
                <column-ref name="table_name" />
            </primary-key>
            <foreign-key name="t_rif40_fdw_tables_tn_fk" references="rif40_tables">
                <column-ref name="table_name" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
            <grant role="PUBLIC" actions="select, references" />
        </grants>
    </table>

    <table name="t_rif40_studies" description="RIF studies"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" auto-increment="true" />
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="geography" description="Geography (e.g EW2001)" type="varchar" length="30" allows-null="false" />
            <column name="project" description="Project running the study. The user must be allocated to the project." type="varchar" length="30" allows-null="false" />
            <column name="study_name" description="Study name" type="varchar" length="200" allows-null="false" />
            <column name="summary" description="Study summary" type="varchar" length="200" allows-null="true" />
            <column name="description" description="Study description" type="varchar" length="2000" allows-null="true" />
            <column name="other_notes" description="Study other notes" type="varchar" length="2000" allows-null="true" />
            <column name="extract_table" description="Extract table. Must only contain A-Z0-9_ and start with a letter." type="varchar" length="30" allows-null="false" />
            <column name="map_table" description="Map table. Must only contain A-Z0-9_ and start with a letter." type="varchar" length="30" allows-null="false" />
            <column name="study_date" description="Study date" type="datetime" allows-null="true" default-value="('now'::text)::timestamp without time zone" />
            <column name="study_type" description="Study type: 1 - disease mapping, 11 - Risk Analysis (many areas, one band), 12 - Risk Analysis (point sources), 13 - Risk Analysis (exposure covariates), 14 - Risk Analysis (coverage shapefile), 15 - Risk Analysis (exposure shapefile)" type="short" allows-null="false" />
            <column name="study_state" description="Study state - C: created, not verfied; V: verified, but no other work done; E - extracted imported or created, but no results or maps created; R: results computed; U: upgraded record from V3.1 RIF (has an indeterminate state; probably R." type="varchar" length="1" allows-null="true" default-value="'C'::character varying" />
            <column name="comparison_geolevel_name" description="Comparison area geolevel name. Must be a valid GEOLEVEL_NAME for the study GEOGRPAHY in T_RIF40_GEOLEVELS, with COMPAREA=1" type="varchar" length="30" allows-null="false" />
            <column name="study_geolevel_name" description="Study area geolevel name" type="varchar" length="30" allows-null="false" />
            <column name="denom_tab" description="Denominator table name. May be &amp;quot;DUMMY&amp;quot; if extract created outside of the RIF. Note the old RIF allowed studies to have different denominators between investigations; this capability has been removed to simplify the extract SQL and to allow a single rotated high performance extract table to be used for all investigations in a study. The extract table is then based on the standard rotated denominator (i.e. in age_sex_group, total format rather than M0 .. M5-9 ... etc) with one extract column per covariate and investigation. Multiple investigations may use a different numerator (1 per investigation)." type="varchar" length="30" allows-null="false" />
            <column name="direct_stand_tab" description="Name of table to be used in direct standardisation. COMPARISON_GEOLEVEL_NAME must be NULL. May be &amp;quot;DUMMY&amp;quot; if extract created outside of the RIF. Note the old RIF allowed studies to have different denominators between investigations; this capability has been removed to simplify the extract SQL and to allow a single rotated high performance extract table to be used for all investigations in a study. The extract table is then based on the standard rotated denominator (i.e. in age_sex_group, total format rather than M0 ... M5-9 ... etc) with one extract column per covariate and investigation. Multiple investigations may use a different numerator (1 per investigation)." type="varchar" length="30" allows-null="true" />
            <column name="suppression_value" description="Suppress results with low cell counts below this value. If the role RIF_NO_SUPRESSION is granted and the user is not a RIF_STUDENT then SUPPRESSION_VALUE=0; otherwise is equals the parameter &amp;quot;SuppressionValue&amp;quot;. If >0 all results with the value or below will be set to 0." type="short" allows-null="false" />
            <column name="extract_permitted" description="Is extract permitted from the database: 0/1. Only a RIF MANAGER may change this value. This user is still permitted to create and run a RIF study and to view the results. Geolevel access is rectricted by the RIF40_GEOLEVELS.RESTRICTED Inforamtion Governance restrictions (0/1). If 1 (Yes) then a) students cannot access this geolevel and b) if the system parameter ExtractControl=1 then the user must be granted permission by a RIF_MANAGER to extract from the database the results, data extract and maps tables. All students must be granted permission by a RIF_MANAGER for any extract if the system parameter ExtractControl=1. This is enforced by the RIF application." type="short" allows-null="true" default-value="0" />
            <column name="transfer_permitted" description="Is transfer permitted from the Secure or Private Network: 0/1. This is for purely documentatary purposes only. Only a RIF MANAGER may change this value. The value defaults to the same as EXTRACT_PERMITTED. Only geolevels where RIF40_GEOLEVELS.RESTRICTED=0 may be transferred." type="short" allows-null="true" default-value="0" />
            <column name="authorised_by" description="Who authorised extract and/or transfer. Must be a RIF MANAGER." type="varchar" length="90" allows-null="true" />
            <column name="authorised_on" description="When was the extract and/or transfer authorised" type="datetime" allows-null="true" />
            <column name="authorised_notes" description="IG authorisation notes. Must be filled in if EXTRACT_PERMITTED=1." type="varchar" length="200" allows-null="true" />
            <column name="audsid" description="Link to Oracle audit subsystem. On Postgres is &amp;quot;backend PID.Julian day.Seconds from midnight.uSeconds (backend start time)&amp;quot;. This can be correlated to the logging messages." type="varchar" length="90" allows-null="true" default-value="sys_context('USERENV'::character varying, 'SESSIONID'::character varying)" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_studies_pk">
                <column-ref name="study_id" />
            </primary-key>
            <foreign-key name="t_rif40_studies_geography_fk" references="rif40_geographies">
                <column-ref name="geography" />
            </foreign-key>
            <foreign-key name="t_rif40_stud_denom_tab_fk" references="rif40_tables">
                <column-ref name="denom_tab" />
            </foreign-key>
            <foreign-key name="t_rif40_stud_direct_stand_fk" references="rif40_tables">
                <column-ref name="direct_stand_tab" />
            </foreign-key>
            <foreign-key name="t_rif40_std_comp_geolevel_fk" references="t_rif40_geolevels">
                <column-ref name="geography" />
                <column-ref name="comparison_geolevel_name" />
            </foreign-key>
            <foreign-key name="t_rif40_std_study_geolevel_fk" references="t_rif40_geolevels">
                <column-ref name="geography" />
                <column-ref name="study_geolevel_name" />
            </foreign-key>
            <foreign-key name="rif40_studies_project_fk" references="t_rif40_projects">
                <column-ref name="project" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_extract_table_uk" unique="true">
                <column-ref name="extract_table" />
            </index>
            <index name="t_rif40_map_table_uk" unique="true">
                <column-ref name="map_table" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="rif40_study_shares" description="Users granted access by a RIF_MANAGER to study data"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="grantor" description="Username doing grant" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="grantee_username" description="Username granted access by a RIF_MANAGER to study data" type="varchar" length="90" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="rif40_study_shares_pk">
                <column-ref name="study_id" />
                <column-ref name="grantee_username" />
            </primary-key>
            <foreign-key name="rif40_study_shares_study_id_fk" references="t_rif40_studies">
                <column-ref name="study_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="rif40_study_shares_grantee_bm" unique="false">
                <column-ref name="grantee_username" />
            </index>
            <index name="rif40_study_shares_grantor_bm" unique="false">
                <column-ref name="grantor" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_user" actions="select" />
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_comparison_areas" description="Links comparison areas and bands for a given study."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="area_id" description="An area id, the value of a geolevel; i.e. the value of the column T_RIF40_GEOLEVELS.GEOLEVEL_NAME in table T_RIF40_GEOLEVELS.LOOKUP_TABLE" type="varchar" length="300" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_comparison_areas_pk">
                <column-ref name="study_id" />
                <column-ref name="area_id" />
            </primary-key>
            <foreign-key name="t_rif40_compareas_study_id_fk" references="t_rif40_studies">
                <column-ref name="study_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_comp_areas_uname" unique="false">
                <column-ref name="username" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_investigations" description="Details of each investigation in a study"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="inv_id" description="Unique investigation index: inv_id. Created by SEQUENCE rif40_inv_id_seq" type="int" allows-null="false" auto-increment="true" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="inv_name" description="Name of investigation. Must be a valid database column name, i.e. only contain A-Z0-9_ and start with a letter." type="varchar" length="20" allows-null="false" />
            <column name="inv_description" description="Description of investigation" type="varchar" length="250" allows-null="false" />
            <column name="classifier" description="Maps classifier. EQUAL_INTERVAL: each classifier band represents the same sized range and intervals change based on max an min, JENKS: Jenks natural breaks, QUANTILE: equiheight (even number) distribution, STANDARD_DEVIATION, UNIQUE_INTERVAL: a version of EQUAL_INTERVAL that takes into account unique values, &amp;lt;BESPOKE&amp;gt;; default QUANTILE. &amp;lt;BESPOKE&amp;gt; classification bands are defined in: RIF40_CLASSFIER_BANDS, RIF40_CLASSFIER_BAND_NAMES and are used to create maps that are comparable accross investigations" type="varchar" length="30" allows-null="true" default-value="'QUANTILE'::character varying" />
            <column name="classifier_bands" description="Map classifier bands; default 5. Must be between 2 and 20" type="short" allows-null="true" default-value="5" />
            <column name="genders" description="Genders to be investigated: 1 - males, 2 female or 3 - both" type="short" allows-null="false" />
            <column name="numer_tab" description="Numerator table name. May be &amp;quot;DUMMY&amp;quot; if extract created outside of the RIF." type="varchar" length="30" allows-null="false" />
            <column name="year_start" description="Year investigation is to start. Must be between the limnits specified in the numerator and denominator tables" type="short" allows-null="false" />
            <column name="year_stop" description="Year investigation is to stop" type="short" allows-null="false" />
            <column name="max_age_group" description="Maximum age group (LOW_AGE to HIGH_AGE) in RIF40_AGE_GROUPS. OFFSET must be &amp;gt; MIN_AGE_GROUP OFFSET, and a valid AGE_GROUP_ID in RIF40_AGE_GROUP_NAMES.AGE_GROUP_NAME" type="int" allows-null="false" />
            <column name="min_age_group" description="Minimum age group (LOW_AGE to HIGH_AGE) in RIF40_AGE_GROUPS. OFFSET must be &amp;lt; MAX_AGE_GROUP OFFSET, and a valid AGE_GROUP_ID in RIF40_AGE_GROUP_NAMES.AGE_GROUP_NAME" type="int" allows-null="false" />
            <column name="investigation_state" description="Investigation state - C: created, not verfied; V: verified, but no other work done; E - extracted imported or created, but no results or maps created; R: results computed; U: upgraded record from V3.1 RIF (has an indeterminate state; probably R." type="varchar" length="1" allows-null="true" default-value="'C'::character varying" />
            <column name="mh_test_type" description="Mantel-Haenszel test type: &amp;quot;No test&amp;quot;, &amp;quot;Comparison Areas&amp;quot;, &amp;quot;Unexposed Area&amp;quot;." type="varchar" length="50" allows-null="true" default-value="'No Test'::character varying" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_investigations_pk">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
            </primary-key>
            <foreign-key name="t_rif40_inv_numer_tab_fk" references="rif40_tables">
                <column-ref name="numer_tab" />
            </foreign-key>
            <foreign-key name="t_rif40_inv_study_id_fk" references="t_rif40_studies">
                <column-ref name="study_id" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_study_areas" description="Links study areas and bands for a given study."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="area_id" description="An area id, the value of a geolevel; i.e. the value of the column T_RIF40_GEOLEVELS.GEOLEVEL_NAME in table T_RIF40_GEOLEVELS.LOOKUP_TABLE" type="varchar" length="300" allows-null="false" />
            <column name="band_id" description="A band allocated to the area" type="int" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_study_areas_pk">
                <column-ref name="study_id" />
                <column-ref name="area_id" />
            </primary-key>
            <foreign-key name="t_rif40_studyareas_study_id_fk" references="t_rif40_studies">
                <column-ref name="study_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_study_areas_band_id" unique="false">
                <column-ref name="band_id" />
            </index>
            <index name="t_rif40_study_areas_uname" unique="false">
                <column-ref name="username" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_study_sql_log" description="Log of SQL executed for study."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="statement_type" description="Statement type: CREATE, INSERT, POST_INSERT, NUMERATOR_CHECK, DENOMINATOR_CHECK" type="varchar" length="30" allows-null="false" />
            <column name="statement_number" description="Statement number" type="int" allows-null="false" />
            <column name="log_message" description="Log message" type="varchar" length="4000" allows-null="false" />
            <column name="log_sqlcode" description="SQL code (SQLSTATE hex code in Postgres)" type="varchar" length="5" allows-null="false" />
            <column name="rowcount" description="Row count" type="long" allows-null="false" />
            <column name="start_time" description="Start time" type="datetime" allows-null="true" default-value="systimestamp((9)::bigint)" />
            <column name="elapsed_time" description="Elapsed time" length="17" scale="17" allows-null="false" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="audsid" description="Link to Oracle audit subsystem. On Postgres is &amp;quot;backend PID.Julian day.Seconds from midnight.uSeconds (backend start time)&amp;quot;. This can be correlated to the logging messages." type="varchar" length="90" allows-null="true" default-value="sys_context('USERENV'::character varying, 'SESSIONID'::character varying)" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_study_sql_log_pk">
                <column-ref name="study_id" />
                <column-ref name="statement_number" />
            </primary-key>
            <foreign-key name="t_rif40_study_sqllog_stdid_fk" references="t_rif40_studies">
                <column-ref name="study_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_study_sqllog_type_bm" unique="false">
                <column-ref name="statement_type" />
            </index>
            <index name="t_rif40_study_sqllog_uname_bm" unique="false">
                <column-ref name="username" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_contextual_stats" description="Contextual stats for results map. Also includes values used in internal calculations."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="inv_id" description="Unique investigation index: inv_id. Created by SEQUENCE rif40_inv_id_seq" type="int" allows-null="false" default-value="(currval('rif40_inv_id_seq'::regclass))::integer" />
            <column name="area_id" description="An area id, the value of a geolevel; i.e. the value of the column T_RIF40_GEOLEVELS.GEOLEVEL_NAME in table T_RIF40_GEOLEVELS.LOOKUP_TABLE" type="int" allows-null="false" />
            <column name="area_population" description="Total population in area" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="area_observed" description="Total observed in area" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="total_comparision_population" description="Total comparison population. Used for internal calculations." length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="variance_high" description="Variance (observed &amp;gt; 100). Used for internal calculations." length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="variance_low" description="Variance (observed &amp;lt;= 100). Used for internal calculations." length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
        </columns>
        <constraints>
            <primary-key name="t_rif40_contextual_stats_pk">
                <column-ref name="study_id" />
                <column-ref name="area_id" />
                <column-ref name="inv_id" />
            </primary-key>
            <foreign-key name="t_rif40_constats_study_id_fk" references="t_rif40_investigations">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_constats_inv_id_fk" unique="false">
                <column-ref name="inv_id" />
            </index>
            <index name="t_rif40_constats_uname_bm" unique="false">
                <column-ref name="username" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_inv_conditions" description="Lines of SQL conditions pertinent to an investigation."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="inv_id" description="Unique investigation index: inv_id. Created by SEQUENCE rif40_inv_id_seq" type="int" allows-null="false" default-value="(currval('rif40_inv_id_seq'::regclass))::integer" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="line_number" description="Line number" type="int" allows-null="false" default-value="1" />
            <column name="min_condition" description="Minimum condition; if max condition is not null SQL WHERE Clause evaluates to: &amp;quot;WHERE &amp;lt;field_name&amp;gt; LIKE '&amp;lt;min_condition&amp;gt;%'&amp;quot;." type="varchar" length="5" allows-null="true" default-value="'1=1'::character varying" />
            <column name="max_condition" description="Maximum condition; if max condition is not null SQL WHERE Clause evaluates to: &amp;quot;WHERE &amp;lt;field_name&amp;gt; BETWEEN '&amp;lt;min_condition&amp;gt;' AND '&amp;lt;max_condition&amp;gt;~'&amp;quot;." type="varchar" length="5" allows-null="true" />
            <column name="predefined_group_name" description="Predefined Group Name. E.g LUNG_CANCER" type="varchar" length="5" allows-null="true" />
            <column name="outcome_group_name" description="Outcome Group Name. E.g SINGLE_VARIABLE_ICD" type="varchar" length="30" allows-null="false" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_inv_conditions_pk">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
                <column-ref name="line_number" />
            </primary-key>
            <foreign-key name="t_rif40_inv_conditons_ogn" references="rif40_outcome_groups">
                <column-ref name="outcome_group_name" />
            </foreign-key>
            <foreign-key name="t_rif40_inv_conditons_pgn" references="rif40_predefined_groups">
                <column-ref name="predefined_group_name" />
            </foreign-key>
            <foreign-key name="t_rif40_inv_conditions_si_fk" references="t_rif40_investigations">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_inv_covariates" description="Details of each covariate used by an investigation in a study"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="inv_id" description="Unique investigation index: inv_id. Created by SEQUENCE rif40_inv_id_seq" type="int" allows-null="false" default-value="(currval('rif40_inv_id_seq'::regclass))::integer" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="covariate_name" description="Covariate name" type="varchar" length="20" allows-null="false" />
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="geography" description="Geography (e.g EW2001). Cannot be changed by the user; present to allow a foreign key to be enforced." type="varchar" length="30" allows-null="false" />
            <column name="study_geolevel_name" description="Study area geolevel name. Must be a valid GEOLEVEL_NAME for the study GEOGRPAHY in T_RIF40_GEOLEVELS. Cannot be changed by the user; present to allow a foreign key to be enforced." type="varchar" length="30" allows-null="true" />
            <column name="min" description="Minimum value for a covariate" length="17" scale="17" allows-null="false" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="max" description="Maximum value for a covariate" length="17" scale="17" allows-null="false" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
        </columns>
        <constraints>
            <primary-key name="t_rif40_inv_covariates_pk">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
                <column-ref name="covariate_name" />
            </primary-key>
            <foreign-key name="t_rif40_inv_cov_cov_name_fk" references="rif40_covariates">
                <column-ref name="geography" />
                <column-ref name="study_geolevel_name" />
                <column-ref name="covariate_name" />
            </foreign-key>
            <foreign-key name="t_rif40_inv_cov_geography_fk" references="rif40_geographies">
                <column-ref name="geography" />
            </foreign-key>
            <foreign-key name="t_rif40_inv_cov_geolevel_fk" references="t_rif40_geolevels">
                <column-ref name="geography" />
                <column-ref name="study_geolevel_name" />
            </foreign-key>
            <foreign-key name="t_rif40_inv_covariates_si_fk" references="t_rif40_investigations">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
            </foreign-key>
        </constraints>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_results" description="RIF Results Table"
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="inv_id" description="Unique investigation inde:inv_id. Created by SEQUENCE rif40_inv_id_seq" type="int" allows-null="false" default-value="(currval('rif40_inv_id_seq'::regclass))::integer" />
            <column name="band_id" description="A band allocated to the area" type="int" allows-null="false" />
            <column name="genders" description="Genders to be investigated: 1 - males, 2 female or 3 - both" type="short" allows-null="false" />
            <column name="adjusted" description="Covariate adjustment: Unadjusted (0) or adjusted (1)" type="short" allows-null="false" />
            <column name="direct_standardisation" description="Standardisation: indirect (0) or direct (1)" type="short" allows-null="false" />
            <column name="observed" description="The number of observed cases" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="expected" description="The number of expected cases or the rate (for direct standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="lower95" description="The lower 95% confidence interval for the relative risk (for indirectly standarised results) or the lower 95% confidence interval for the rate (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="upper95" description="The upper 95% confidence interval for the relative risk (for indirectly standarised results) or the upper 95% confidence interval for the rate (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="relative_risk" description="Relaitive risk (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="smoothed_relative_risk" description="Smoothed relaive risk (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="posterior_probability" description="The posterior probability (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="posterior_probability_lower95" description="The lower 95% confidence interval of the posterior probability (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="posterior_probability_upper95" description="The upper 95% confidence interval of the posterior probability (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="residual_relative_risk" description="The residual relative risk(for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="residual_rr_lower95" description="The lower 95% confidence interval of the residual relative risk(for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="residual_rr_upper95" description="The upper 95% confidence interval of the residual relative risk(for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="smoothed_smr" description="The smoothed SMR [fully Bayesian smoothing] (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="smoothed_smr_lower95" description="The lower 95% confidence interval of the smoothed SMR [fully Bayesian smoothing] (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
            <column name="smoothed_smr_upper95" description="The upper 95% confidence interval of the smoothed SMR [fully Bayesian smoothing] (for indirectly standarised results) or NULL (for directly standardised results)" length="17" scale="17" allows-null="true" >
                <column-override dbms="postgres8" raw-type="float8" />
            </column>
        </columns>
        <constraints>
            <primary-key name="t_rif40_results_pk">
                <column-ref name="study_id" />
                <column-ref name="band_id" />
                <column-ref name="inv_id" />
                <column-ref name="genders" />
                <column-ref name="adjusted" />
                <column-ref name="direct_standardisation" />
            </primary-key>
            <foreign-key name="t_rif40_results_study_id_fk" references="t_rif40_investigations">
                <column-ref name="study_id" />
                <column-ref name="inv_id" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_results_band_id_bm" unique="false">
                <column-ref name="band_id" />
            </index>
            <index name="t_rif40_results_inv_id_fk" unique="false">
                <column-ref name="inv_id" />
            </index>
            <index name="t_rif40_results_username_bm" unique="false">
                <column-ref name="username" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <table name="t_rif40_study_sql" description="SQL created for study execution."
            size="medium" update-frequency="medium" select-frequency="medium">
        <columns>
            <column name="username" description="Username" type="varchar" length="90" allows-null="true" default-value="current_user()" />
            <column name="study_id" description="Unique study index: study_id. Created by SEQUENCE rif40_study_id_seq" type="int" allows-null="false" default-value="(currval('rif40_study_id_seq'::regclass))::integer" />
            <column name="statement_type" description="Statement type: CREATE, INSERT, POST_INSERT, NUMERATOR_CHECK, DENOMINATOR_CHECK" type="varchar" length="30" allows-null="false" />
            <column name="statement_number" description="Statement number" type="int" allows-null="false" />
            <column name="sql_text" description="SQL text" type="varchar" length="4000" allows-null="false" />
            <column name="line_number" description="Line number" type="int" allows-null="false" />
            <column name="status" description="Status: C(reated) or R(un)" type="varchar" length="1" allows-null="true" />
        </columns>
        <constraints>
            <primary-key name="t_rif40_study_sql_pk">
                <column-ref name="study_id" />
                <column-ref name="statement_number" />
                <column-ref name="line_number" />
            </primary-key>
            <foreign-key name="t_rif40_study_sql_sid_line_fk" references="t_rif40_study_sql_log">
                <column-ref name="study_id" />
                <column-ref name="statement_number" />
            </foreign-key>
        </constraints>
        <indexes>
            <index name="t_rif40_study_sql_type_bm" unique="false">
                <column-ref name="statement_type" />
            </index>
            <index name="t_rif40_study_sql_uname_bm" unique="false">
                <column-ref name="username" />
            </index>
        </indexes>
        <grants>
            <grant role="rif_manager" actions="select, insert, delete, update" />
            <grant role="rif_user" actions="select, insert, delete, update" />
            <grant role="rif40" actions="select, references, insert, delete, update" />
        </grants>
    </table>

    <!--
    ======================================================================
        Views
    ======================================================================
    -->

    <view name="rif40_comparison_areas" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.area_id
   FROM (t_rif40_comparison_areas c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_contextual_stats" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.inv_id,
    c.area_id,
    c.area_population,
    c.area_observed,
    c.total_comparision_population,
    c.variance_high,
    c.variance_low
   FROM (t_rif40_contextual_stats c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_fdw_tables" description="">
        <view-definition><![CDATA[
             SELECT t_rif40_fdw_tables.username,
    t_rif40_fdw_tables.table_name,
    t_rif40_fdw_tables.create_status,
    t_rif40_fdw_tables.error_message,
    t_rif40_fdw_tables.date_created,
    t_rif40_fdw_tables.rowtest_passed
   FROM t_rif40_fdw_tables
  WHERE ((t_rif40_fdw_tables.username)::name = "current_user"());
        ]]></view-definition>
    </view>

    <view name="rif40_geolevels" description="">
        <view-definition><![CDATA[
             SELECT a.geography,
    a.geolevel_name,
    a.geolevel_id,
    a.description,
    a.lookup_table,
    a.lookup_desc_column,
    a.shapefile,
    a.centroidsfile,
    a.shapefile_table,
    a.shapefile_area_id_column,
    a.shapefile_desc_column,
    a.centroids_table,
    a.centroids_area_id_column,
    a.avg_npoints_geom,
    a.avg_npoints_opt,
    a.file_geojson_len,
    a.leg_geom,
    a.leg_opt,
    a.covariate_table,
    a.resolution,
    a.comparea,
    a.listing,
    a.restricted,
    a.centroidxcoordinate_column,
    a.centroidycoordinate_column
   FROM t_rif40_geolevels a
  WHERE (((sys_context('SAHSU_CONTEXT'::character varying, 'RIF_STUDENT'::character varying))::text = 'YES'::text) AND (a.restricted <> 1))
UNION
 SELECT a.geography,
    a.geolevel_name,
    a.geolevel_id,
    a.description,
    a.lookup_table,
    a.lookup_desc_column,
    a.shapefile,
    a.centroidsfile,
    a.shapefile_table,
    a.shapefile_area_id_column,
    a.shapefile_desc_column,
    a.centroids_table,
    a.centroids_area_id_column,
    a.avg_npoints_geom,
    a.avg_npoints_opt,
    a.file_geojson_len,
    a.leg_geom,
    a.leg_opt,
    a.covariate_table,
    a.resolution,
    a.comparea,
    a.listing,
    a.restricted,
    a.centroidxcoordinate_column,
    a.centroidycoordinate_column
   FROM t_rif40_geolevels a
  WHERE ((sys_context('SAHSU_CONTEXT'::character varying, 'RIF_STUDENT'::character varying) IS NULL) OR ((sys_context('SAHSU_CONTEXT'::character varying, 'RIF_STUDENT'::character varying))::text = 'NO'::text))
  ORDER BY 1, 3 DESC;
        ]]></view-definition>
    </view>

    <view name="rif40_inv_conditions" description="">
        <view-definition><![CDATA[
             WITH a AS (
         SELECT c.username,
            c.study_id,
            c.inv_id,
            c.line_number,
            c.min_condition,
            c.max_condition,
            c.predefined_group_name,
            c.outcome_group_name,
            i.numer_tab,
            b.field_name,
                CASE
                    WHEN (c.predefined_group_name IS NOT NULL) THEN (((ROW(g.condition, '%', quote_ident(lower((b.field_name)::text))) || ' /* Pre defined group: '::text) || (g.predefined_group_description)::text) || ' */'::text)
                    WHEN (c.max_condition IS NOT NULL) THEN (((((quote_ident(lower((b.field_name)::text)) || ' BETWEEN '''::text) || (c.min_condition)::text) || ''' AND '''::text) || (c.max_condition)::text) || '~'' /* Range filter */'::text)
                    ELSE (((quote_ident(lower((b.field_name)::text)) || ' LIKE '''::text) || (c.min_condition)::text) || '%'' /* Value filter */'::text)
                END AS condition
           FROM t_rif40_investigations i,
            rif40_outcome_groups b,
            ((t_rif40_inv_conditions c
             LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
             LEFT JOIN rif40_predefined_groups g ON (((c.predefined_group_name)::text = (g.predefined_group_name)::text)))
          WHERE ((((c.inv_id = i.inv_id) AND (c.study_id = i.study_id)) AND ((c.outcome_group_name)::text = (b.outcome_group_name)::text)) AND (((("current_user"() = 'rif40'::name) OR ((c.username)::name = "current_user"())) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
                   FROM user_role_privs
                  WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text))))
        )
 SELECT a.username,
    a.study_id,
    a.inv_id,
    a.line_number,
    a.min_condition,
    a.max_condition,
    a.predefined_group_name,
    a.outcome_group_name,
    a.numer_tab,
    a.field_name,
    a.condition,
        CASE
            WHEN (d.attrelid IS NOT NULL) THEN true
            ELSE false
        END AS columnn_exists,
    col_description(((lower((a.numer_tab)::text))::regclass)::oid, (d.attnum)::integer) AS column_comment
   FROM (a
     LEFT JOIN pg_attribute d ON (((((lower((a.numer_tab)::text))::regclass)::oid = d.attrelid) AND ((d.attname)::text = lower((a.field_name)::text)))))
  ORDER BY a.username, a.inv_id;
        ]]></view-definition>
    </view>

    <view name="rif40_inv_covariates" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.inv_id,
    c.covariate_name,
    c.min,
    c.max,
    c.geography,
    c.study_geolevel_name
   FROM (t_rif40_inv_covariates c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_investigations" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.inv_id,
    c.study_id,
    c.inv_name,
    c.year_start,
    c.year_stop,
    c.max_age_group,
    c.min_age_group,
    c.genders,
    c.numer_tab,
    c.mh_test_type,
    c.inv_description,
    c.classifier,
    c.classifier_bands,
    c.investigation_state
   FROM (t_rif40_investigations c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_num_denom" description="">
        <view-definition><![CDATA[
             WITH n AS (
         SELECT n1.geography,
            n1.numerator_table,
            n1.numerator_description,
            n1.automatic,
            n1.theme_description
           FROM ( SELECT g.geography,
                    n_1.table_name AS numerator_table,
                    n_1.description AS numerator_description,
                    n_1.automatic,
                    t.description AS theme_description
                   FROM rif40_geographies g,
                    rif40_tables n_1,
                    rif40_health_study_themes t
                  WHERE ((((n_1.isnumerator = 1) AND (n_1.automatic = 1)) AND (rif40_is_object_resolvable(n_1.table_name) = 1)) AND ((n_1.theme)::text = (t.theme)::text))) n1
          WHERE (rif40_num_denom_validate(n1.geography, n1.numerator_table) = 1)
        ), d AS (
         SELECT d1.geography,
            d1.denominator_table,
            d1.denominator_description
           FROM ( SELECT g.geography,
                    d_1.table_name AS denominator_table,
                    d_1.description AS denominator_description
                   FROM rif40_geographies g,
                    rif40_tables d_1
                  WHERE (((d_1.isindirectdenominator = 1) AND (d_1.automatic = 1)) AND (rif40_is_object_resolvable(d_1.table_name) = 1))) d1
          WHERE ((rif40_num_denom_validate(d1.geography, d1.denominator_table) = 1) AND (rif40_auto_indirect_checks(d1.denominator_table) IS NULL))
        )
 SELECT n.geography,
    n.numerator_table,
    n.numerator_description,
    n.theme_description,
    d.denominator_table,
    d.denominator_description,
    n.automatic
   FROM n,
    d
  WHERE ((n.geography)::text = (d.geography)::text)
  ORDER BY n.geography, n.numerator_table, n.theme_description;
        ]]></view-definition>
    </view>

    <view name="rif40_num_denom_errors" description="">
        <view-definition><![CDATA[
             WITH n AS (
         SELECT n1.geography,
            n1.numerator_table,
            n1.numerator_description,
            n1.automatic,
            n1.is_object_resolvable,
            n1.n_num_denom_validated,
            n1.numerator_owner
           FROM ( SELECT g.geography,
                    n_1.table_name AS numerator_table,
                    n_1.description AS numerator_description,
                    n_1.automatic,
                    rif40_is_object_resolvable(n_1.table_name) AS is_object_resolvable,
                    rif40_num_denom_validate(g.geography, n_1.table_name) AS n_num_denom_validated,
                    rif40_object_resolve(n_1.table_name) AS numerator_owner
                   FROM rif40_geographies g,
                    rif40_tables n_1
                  WHERE ((n_1.isnumerator = 1) AND (n_1.automatic = 1))) n1
        ), d AS (
         SELECT d1.geography,
            d1.denominator_table,
            d1.denominator_description,
            d1.is_object_resolvable,
            d1.d_num_denom_validated,
            d1.denominator_owner,
            (rif40_auto_indirect_checks(d1.denominator_table))::text AS auto_indirect_error
           FROM ( SELECT g.geography,
                    d_1.table_name AS denominator_table,
                    d_1.description AS denominator_description,
                    rif40_is_object_resolvable(d_1.table_name) AS is_object_resolvable,
                    rif40_num_denom_validate(g.geography, d_1.table_name) AS d_num_denom_validated,
                    rif40_object_resolve(d_1.table_name) AS denominator_owner
                   FROM rif40_geographies g,
                    rif40_tables d_1
                  WHERE ((d_1.isindirectdenominator = 1) AND (d_1.automatic = 1))) d1
        )
 SELECT n.geography,
    n.numerator_owner,
    n.numerator_table,
    n.is_object_resolvable AS is_numerator_resolvable,
    n.n_num_denom_validated,
    n.numerator_description,
    d.denominator_owner,
    d.denominator_table,
    d.is_object_resolvable AS is_denominator_resolvable,
    d.d_num_denom_validated,
    d.denominator_description,
    n.automatic,
        CASE
            WHEN (d.auto_indirect_error IS NULL) THEN 0
            ELSE 1
        END AS auto_indirect_error_flag,
    d.auto_indirect_error,
    f.create_status AS n_fdw_create_status,
    f.error_message AS n_fdw_error_message,
    f.date_created AS n_fdw_date_created,
    f.rowtest_passed AS n_fdw_rowtest_passed
   FROM d,
    (n
     LEFT JOIN rif40_fdw_tables f ON (((n.numerator_table)::text = (f.table_name)::text)))
  WHERE ((n.geography)::text = (d.geography)::text)
  ORDER BY n.geography, n.numerator_owner, n.n_num_denom_validated;
        ]]></view-definition>
    </view>

    <view name="rif40_numerator_outcome_columns" description="">
        <view-definition><![CDATA[
             WITH a AS (
         SELECT z.geography,
            a_1.table_name,
            c.outcome_group_name,
            c.outcome_type,
            c.outcome_group_description,
            c.field_name,
            c.multiple_field_count
           FROM rif40_num_denom z,
            rif40_tables a_1,
            rif40_table_outcomes b,
            rif40_outcome_groups c
          WHERE ((((a_1.table_name)::text = (z.numerator_table)::text) AND ((a_1.table_name)::text = (b.numer_tab)::text)) AND ((c.outcome_group_name)::text = (b.outcome_group_name)::text))
        )
 SELECT a.geography,
    a.table_name,
    a.outcome_group_name,
    a.outcome_type,
    a.outcome_group_description,
    a.field_name,
    a.multiple_field_count,
        CASE
            WHEN (d.attrelid IS NOT NULL) THEN true
            ELSE false
        END AS columnn_exists,
        CASE
            WHEN (d.attrelid IS NOT NULL) THEN col_description(((lower((a.table_name)::text))::regclass)::oid, (d.attnum)::integer)
            ELSE NULL::text
        END AS column_comment
   FROM (a
     LEFT JOIN pg_attribute d ON (((((lower((a.table_name)::text))::regclass)::oid = d.attrelid) AND ((d.attname)::text = lower((a.field_name)::text)))));
        ]]></view-definition>
    </view>

    <view name="rif40_parameters" description="">
        <view-definition><![CDATA[
             SELECT t_rif40_parameters.param_name,
    t_rif40_parameters.param_value,
    t_rif40_parameters.param_description
   FROM t_rif40_parameters
  WHERE ((t_rif40_parameters.param_name)::text <> 'SuppressionValue'::text)
UNION
 SELECT p.param_name,
        CASE
            WHEN (a.total = 1) THEN '0'::character varying
            ELSE p.param_value
        END AS param_value,
    p.param_description
   FROM t_rif40_parameters p,
    ( SELECT count(*) AS total
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_NO_SUPPRESSION'::text)) a
  WHERE ((p.param_name)::text = 'SuppressionValue'::text)
UNION
 SELECT 'RifParametersTable'::character varying AS param_name,
    'Virtual'::character varying AS param_value,
    'Is this the T_RIF40_PARAMETERS table or the VIRTUAL view'::character varying AS param_description
  ORDER BY 1;
        ]]></view-definition>
    </view>

    <view name="rif40_projects" description="">
        <view-definition><![CDATA[
             SELECT t_rif40_projects.project,
    t_rif40_projects.description,
    t_rif40_projects.date_started,
    t_rif40_projects.date_ended
   FROM t_rif40_projects
  WHERE ((t_rif40_projects.project)::text IN ( SELECT t_rif40_user_projects.project
           FROM t_rif40_user_projects
          WHERE (((t_rif40_user_projects.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
                   FROM user_role_privs
                  WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text))))))
  ORDER BY t_rif40_projects.project;
        ]]></view-definition>
    </view>

    <view name="rif40_results" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.inv_id,
    c.band_id,
    c.genders,
    c.direct_standardisation,
    c.adjusted,
    c.observed,
    c.expected,
    c.lower95,
    c.upper95,
    c.relative_risk,
    c.smoothed_relative_risk,
    c.posterior_probability,
    c.posterior_probability_upper95,
    c.posterior_probability_lower95,
    c.residual_relative_risk,
    c.residual_rr_lower95,
    c.residual_rr_upper95,
    c.smoothed_smr,
    c.smoothed_smr_lower95,
    c.smoothed_smr_upper95
   FROM (t_rif40_results c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_studies" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.extract_table,
    c.study_name,
    c.summary,
    c.description,
    c.other_notes,
    c.study_date,
    c.geography,
    c.study_type,
    c.study_state,
    c.comparison_geolevel_name,
    c.denom_tab,
    c.direct_stand_tab,
    i.year_start,
    i.year_stop,
    i.max_age_group,
    i.min_age_group,
    c.study_geolevel_name,
    c.map_table,
    c.suppression_value,
    c.extract_permitted,
    c.transfer_permitted,
    c.authorised_by,
    c.authorised_on,
    c.authorised_notes,
    c.audsid,
        CASE
            WHEN ((g.partition = 1) AND (((i.year_stop - i.year_start))::numeric >= ((2)::numeric * p.parallelisation))) THEN p.parallelisation
            ELSE (0)::numeric
        END AS partition_parallelisation,
    l.covariate_table,
    c.project,
    pj.description AS project_description
   FROM ((((((t_rif40_studies c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
     LEFT JOIN ( SELECT i2.study_id,
            max(i2.year_stop) AS year_stop,
            min(i2.year_start) AS year_start,
            max(i2.max_age_group) AS max_age_group,
            min(i2.min_age_group) AS min_age_group
           FROM t_rif40_investigations i2
          GROUP BY i2.study_id) i ON ((c.study_id = i.study_id)))
     LEFT JOIN rif40_geographies g ON (((c.geography)::text = (g.geography)::text)))
     LEFT JOIN ( SELECT to_number((t_rif40_parameters.param_value)::text, '999990'::text) AS parallelisation
           FROM t_rif40_parameters
          WHERE ((t_rif40_parameters.param_name)::text = 'Parallelisation'::text)) p ON ((1 = 1)))
     LEFT JOIN t_rif40_geolevels l ON ((((c.geography)::text = (l.geography)::text) AND ((c.study_geolevel_name)::text = (l.geolevel_name)::text))))
     LEFT JOIN t_rif40_projects pj ON (((pj.project)::text = (c.project)::text)))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_study_areas" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.area_id,
    c.band_id
   FROM (t_rif40_study_areas c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_study_sql" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.statement_type,
    c.statement_number,
    c.sql_text,
    c.line_number,
    c.status
   FROM (t_rif40_study_sql c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_study_sql_log" description="">
        <view-definition><![CDATA[
             SELECT c.username,
    c.study_id,
    c.statement_type,
    c.statement_number,
    c.log_message,
    c.audsid,
    c.log_sqlcode,
    c.rowcount,
    c.start_time,
    c.elapsed_time
   FROM (t_rif40_study_sql_log c
     LEFT JOIN rif40_study_shares s ON (((c.study_id = s.study_id) AND ((s.grantee_username)::name = "current_user"()))))
  WHERE ((((c.username)::name = "current_user"()) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text)))) OR ((s.grantee_username IS NOT NULL) AND ((s.grantee_username)::text <> ''::text)))
  ORDER BY c.username;
        ]]></view-definition>
    </view>

    <view name="rif40_user_projects" description="">
        <view-definition><![CDATA[
             SELECT a.project,
    a.username,
    a.grant_date,
    a.revoke_date,
    b.description,
    b.date_started,
    b.date_ended
   FROM t_rif40_user_projects a,
    t_rif40_projects b
  WHERE ((((a.project)::text = (b.project)::text) AND ((a.username)::name = "current_user"())) OR ('RIF_MANAGER'::text = ( SELECT user_role_privs.granted_role
           FROM user_role_privs
          WHERE (user_role_privs.granted_role = 'RIF_MANAGER'::text))))
  ORDER BY a.project;
        ]]></view-definition>
    </view>

    <view name="rif40_user_version" description="">
        <view-definition><![CDATA[
             SELECT '$Revision: 1.11 $'::character varying AS user_schema_revision;
        ]]></view-definition>
    </view>
</db-schema>
