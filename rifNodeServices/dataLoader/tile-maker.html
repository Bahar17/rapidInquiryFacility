<!DOCTYPE html>
<html>
<head>
    <script src="jquery-2.2.3.js"></script> 
    <link rel="stylesheet" href="leaflet/leaflet.css" />
    <script src="leaflet/leaflet.js"></script>
    <script src="topojson.min.js"></script>
    <link rel="stylesheet" href="leaflet.zoomdisplay.css" />
    <script src="leaflet.zoomdisplay.js"></script>
    <script src="jquery.form.js"></script> 
<!--    <script src="angular.min.js"></script> -->
    <script src="async.js"></script> 
	<link rel="stylesheet" href="tile-maker.css" />
    <script src="Control.FullScreen.js"></script>
	<link rel="stylesheet" href="Control.FullScreen.css" />
	<script src="Control.Loading.js"></script>
	<link rel="stylesheet" href="Control.Loading.css" />
	<script type="text/javascript" src="sizeof.js"></script>
	<script type="text/javascript" src="jszip.js"></script>
    <link href="jquery-ui-1.11.4.custom/jquery-ui.css" rel="stylesheet"/>
    <script src="jquery-ui-1.11.4.custom/jquery-ui.js"></script>
    <script src="xml2json.js"></script>
	
    <script src="nodeGeoSpatialFrontEnd.js"></script> 
    <script src="tile-maker_fileParser.js"></script>
    <script> 

var tabs;
var progressbar;
var progressLabel;	

// wait for the DOM to be loaded 
// prepare the JQuery form when the DOM is ready 
$(document).ready(function documentReady() { 

	var height="100%";
	if (document.getElementById('tilemakerbody')) {
		console.log("Body; h x w: " + document.getElementById('tilemakerbody').offsetHeight + "x" + document.getElementById('tilemakerbody').offsetWidth);
		height=document.getElementById('tilemakerbody').offsetHeight;
	}
	
	//
	// Setup tabs
	//	
	$(function setupTabs() {
		tabs=$("#tabs").tabs({
			create: function setupTabsCreated() {
				var ntabs=$('#tabs >ul >li').size();
				var ltabs=$( ".selector" ).tabs("tabs");
				
				console.log("setupTabs().oncreate: " + ntabs + " tabs setup");
				setupMap();
				formSetup('shpConvert', 'Shapefile');
				
				
				$(function initFields() {
					$( "#simplificationFactor" ).slider({				// Simplication slider - needs to be replaced with pure JQuery UI version
					});
					
					$( "#quantizationSelect" )							// Quantization selector
					  .selectmenu()
					  .selectmenu( "menuWidget" )
						.addClass( "overflow" );
						
					$( "#quantizationSelect" ).on( "selectmenuchange", function(event, ui) { // Dummy change function for test purposes
						quantizationSelectChange(this.value);
					});
	
					$('input').addClass("ui-corner-all");				// Nice round corners everywhere
	  
					$( "#diagnostics, #shpConvertSubmit" ).button();	// Diagnostics button
 
					$( document ).tooltip({position: { 					// Enable tooltips
							  my: "right bottom+50"
						  },
						  tooltipClass: "entry-tooltip-positioner"
						  });							

//					Accordion is initialised dynamically					
				});
				
//				ltabs.tabs("refresh" );
				
				$(function setupProgress() {							// Progressbar
					progressbar = $( "#progressbar" );
					progressLabel = $( ".progress-label" );

					progressbar.progressbar({
						value: 0,
						
						create: function setupProgressCreated() {
							progressLabel.text("");
							console.log("setupProgress().oncreate: setup");
						},
						change: function functionsetupProgessChangeded() {
							if (progressbar.progressbar( "value" ) > 0) {
								progressLabel.text( progressbar.progressbar( "value" ) + "%" );
							}
						}
					});
					$(".progress-label").text("Ready");	
				});	
				
				for (var i=(ntabs-1); i>=0; i--) {
					$( "#tabs" ).tabs( "option", "active", i); // Activate all panels. This sets the height correctly
				}
				
			},
			load: function setupTabsLoaded() {
				console.log("setupTabs().onload");
			},			
			heightStyle: "fill"
		}).css({
			'min-height': height+"px"
		});
	});
	
//
// Enable resize
//
	$( window ).resize(function() {	
		console.log("setupTabs(): resize");
		setupMap();
		tabs.tabs("refresh" );
	});

});

function quantizationSelectChange(value) {
	console.log("quantizationSelectChange() new value: " + value);
}	

/*
 * Angular controller
 */
// var app = angular.module('shpConvert', []);
// app.controller('shpConvertCtrl', function shpConvertCtrl($scope) {
//});

    </script>
<title>Tile Maker</title>
</head>
  <body id="tilemakerbody">
 <!--    <div ng-app="shpConvert" ng-controller="shpConvertCtrl"> -->
   <div id="tilemaker">
	<div id="tabs">
         <ul id="tabbox">
            <li><a href = "#shapeFileSelectortab">Shapefile selector</a></li>
            <li><a href = "#maptab">Map</a></li>
            <li><a href = "#statustab">Diagnostics</a></li>
         </ul>
		 <div id="shapeFileSelectortab">
		   <div id="shapeFileSelector">
			<form id="shpConvert" action="http://127.0.0.1:3000/shpConvert" method="POST"
				  enctype="multipart/form-data">
			  <fieldset>	
			  <label title="Please upload one or more shapefiles; these may be in zip format and must contain the .dbf (table data), .shp (geospatial data) and .prj (projection) files" 
			         class="customFileUpload">Select a file/files to upload
			    <input id="files" type="file" name="file_list" size="50" multiple="multiple"/>
			    <input type="text" id="customFileUploadInput" value="&nbsp;No files selected" readonly size="16"><br>			
			  </label>	  
			  <label title="Quantization: select the reduction in the maximum number of differentiable points along either dimension" for="quantization">Quantization:
			    <select id="quantizationSelect" name="quantization" form="shpConvert">
					<option value="100000000">1 in 100 million</option>
					<option value="10000000">1 in 10 million</option>
					<option value="1000000" selected="selected">1 in 1 million</option>
					<option value="100000">1 in 100,000</option>
					<option value="10000">1 in 10,000</option>
					<option value="5000">1 in 5,000</option>
					<option value="3000">1 in 3,000</option>
					<option value="1500">1 in 1,500</option>
			    </select> 		
			  </label>
			  <label title="Please enter the amount of points to keep when simplifiying each zoomlevel between 0 and 1; so 0.75 is keep 75% of the points">Simplification factor:
			    <input id="simplificationFactor" name="simplificationFactor" type="range"
			           defaultValue="0.75" value="0.75" min="0.1" max="1" step="0.05" onchange="updateSimplificationFactorInput(this.value);" />
			    <input type="text" id="simplificationFactorInput" value="0.75" readonly size="4">
			  </label> 
			  <label title="Enable diagnostics" for="diagnostics">Diagnostics</label>  
			  <input id="diagnostics" name="diagnostics" type="checkbox" name="verbose" value="true">
				  <div id="accordion">
				  </div>
			  <input id="shpConvertSubmit" name="shpConvertSubmit" type="submit" value="Upload File(s)" />&nbsp;
			  </fieldset>	  
			</form>		
		   </div>	
		   <div id="progressbar">
			 <div class="progress-label">0%</div>
		   </div>		   
		 </div>
		 <div id="maptab">
		   <div id="map">
		   </div>
		 </div>
		 <div id="statustab">
	  	   <div id="status">
		   </div>
		 </div>
		 <div id="error" title="Error"></div> 
	  </div>
	</div>
 <!--   </div> -->
  </body>
</html>